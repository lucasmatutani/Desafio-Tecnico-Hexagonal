<mxfile host="app.diagrams.net">
  <diagram name="Inventory Management Architecture" id="architecture">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        
        <!-- TÃTULO -->
        <mxCell id="title" value="INVENTORY MANAGEMENT SYSTEM&#xa;Event-Driven Microservices Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="600" height="60" as="geometry"/>
        </mxCell>
        
        <!-- LEGENDA -->
        <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="40" y="100" width="280" height="180" as="geometry"/>
        </mxCell>
        <mxCell id="legend-title" value="LEGENDA" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="50" y="110" width="100" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="legend-sync" value="â”â”â”  ComunicaÃ§Ã£o SÃ­ncrona (HTTP/REST)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="50" y="140" width="260" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="legend-async" value="â•Œâ•Œâ•Œ  ComunicaÃ§Ã£o AssÃ­ncrona (Eventos)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="50" y="170" width="260" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="legend-impl" value="â­ = Implementado" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="50" y="200" width="260" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="legend-design" value="ðŸ“ = Apenas documentado (design)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="50" y="230" width="260" height="20" as="geometry"/>
        </mxCell>
        
        <!-- CLIENTE -->
        <mxCell id="user" value="ðŸ‘¤ USER&#xa;(Web/Mobile)" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="730" y="100" width="100" height="100" as="geometry"/>
        </mxCell>
        
        <!-- API GATEWAY -->
        <mxCell id="api-gateway" value="ðŸŸ  API GATEWAY&#xa;(Amazon API Gateway)&#xa;&#xa;â€¢ Rate Limiting&#xa;â€¢ Authentication&#xa;â€¢ Request Validation&#xa;&#xa;Port: 4566" style="shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="680" y="240" width="200" height="140" as="geometry"/>
        </mxCell>
        
        <!-- Arrow: User â†’ API Gateway -->
        <mxCell id="arrow-user-gateway" value="HTTPS" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;" edge="1" parent="1" source="user" target="api-gateway">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- INVENTORY SERVICE -->
        <mxCell id="inventory-service" value="ðŸŸ¢ INVENTORY SERVICE&#xa;â­ IMPLEMENTADO&#xa;&#xa;Write Model (Commands)&#xa;&#xa;â€¢ POST /reserve&#xa;â€¢ POST /commit&#xa;â€¢ POST /release&#xa;&#xa;Port: 8081" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;fontStyle=1;align=center;" vertex="1" parent="1">
          <mxGeometry x="680" y="440" width="200" height="180" as="geometry"/>
        </mxCell>
        
        <!-- QUERY SERVICE -->
        <mxCell id="query-service" value="ðŸ©· QUERY SERVICE&#xa;ðŸ“ DESIGNED&#xa;&#xa;Read Model (Queries)&#xa;&#xa;â€¢ GET /{store}/{sku}&#xa;â€¢ GET /analytics&#xa;â€¢ GET /reports&#xa;&#xa;Port: 8083" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;fontStyle=1;align=center;" vertex="1" parent="1">
          <mxGeometry x="400" y="440" width="200" height="180" as="geometry"/>
        </mxCell>
        
        <!-- EVENT STORE SERVICE -->
        <mxCell id="eventstore-service" value="ðŸ”µ EVENT STORE SERVICE&#xa;ðŸ“ DESIGNED&#xa;&#xa;Audit Trail (History)&#xa;&#xa;â€¢ GET /events?aggregateId&#xa;â€¢ GET /events/{eventId}&#xa;â€¢ POST /replay&#xa;&#xa;Port: 8082" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;fontStyle=1;align=center;" vertex="1" parent="1">
          <mxGeometry x="960" y="440" width="200" height="180" as="geometry"/>
        </mxCell>
        
        <!-- Arrows: API Gateway â†’ Services (HTTP) -->
        <mxCell id="arrow-gateway-inventory" value="HTTP/REST" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;" edge="1" parent="1" source="api-gateway" target="inventory-service">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="arrow-gateway-query" value="HTTP/REST" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;" edge="1" parent="1" source="api-gateway" target="query-service">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="arrow-gateway-eventstore" value="HTTP/REST&#xa;(Admin)" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;" edge="1" parent="1" source="api-gateway" target="eventstore-service">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- INVENTORY DATABASE (PostgreSQL) -->
        <mxCell id="inventory-db" value="ðŸŸ¢ Amazon RDS&#xa;(PostgreSQL)&#xa;&#xa;â€¢ inventory&#xa;â€¢ reservations&#xa;â€¢ outbox_events" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="700" y="670" width="160" height="120" as="geometry"/>
        </mxCell>
        
        <!-- Arrow: Inventory Service â†’ PostgreSQL -->
        <mxCell id="arrow-inventory-db" value="JDBC" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;" edge="1" parent="1" source="inventory-service" target="inventory-db">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- SNS TOPIC -->
        <mxCell id="sns-topic" value="ðŸ“¡ AMAZON SNS TOPIC&#xa;(inventory-events-topic)&#xa;&#xa;â€¢ Pub/Sub Pattern&#xa;â€¢ Fan-out (1 â†’ N)&#xa;â€¢ Message Attributes&#xa;&#xa;ARN: arn:aws:sns:..." style="shape=cloud;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="620" y="840" width="320" height="120" as="geometry"/>
        </mxCell>
        
        <!-- Arrow: Inventory Service â†’ SNS (Async) -->
        <mxCell id="arrow-inventory-sns" value="Publish Event&#xa;(via Outbox Publisher)" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="inventory-db" target="sns-topic">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- SQS QUEUES -->
        <mxCell id="sqs-eventstore" value="ðŸ“¨ SQS&#xa;eventstore-queue&#xa;&#xa;Retention: 14 days&#xa;+DLQ" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="260" y="1020" width="140" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="sqs-query" value="ðŸ“¨ SQS&#xa;query-projection-queue&#xa;&#xa;Retention: 4 days&#xa;+DLQ" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="440" y="1020" width="140" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="sqs-notification" value="ðŸ“¨ SQS&#xa;notification-queue&#xa;&#xa;Retention: 1 day&#xa;+DLQ" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="620" y="1020" width="140" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="sqs-analytics" value="ðŸ“¨ SQS&#xa;analytics-queue&#xa;&#xa;Retention: 7 days&#xa;+DLQ" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="800" y="1020" width="140" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="sqs-backup" value="ðŸ“¨ SQS&#xa;backup-queue&#xa;&#xa;Retention: 14 days&#xa;+DLQ" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="980" y="1020" width="140" height="100" as="geometry"/>
        </mxCell>
        
        <!-- Arrows: SNS â†’ SQS (Fan-out) -->
        <mxCell id="arrow-sns-sqs1" value="Fan-out" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="sns-topic" target="sqs-eventstore">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="arrow-sns-sqs2" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="sns-topic" target="sqs-query">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="arrow-sns-sqs3" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="sns-topic" target="sqs-notification">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="arrow-sns-sqs4" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="sns-topic" target="sqs-analytics">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="arrow-sns-sqs5" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="sns-topic" target="sqs-backup">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- CONSUMER SERVICES -->
        <mxCell id="eventstore-consumer" value="ðŸ”µ EVENT STORE&#xa;SERVICE&#xa;&#xa;â€¢ Store Events&#xa;â€¢ Audit Trail&#xa;â€¢ Event Replay" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="260" y="1160" width="140" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="query-consumer" value="ðŸ©· QUERY&#xa;SERVICE&#xa;&#xa;â€¢ Update Views&#xa;â€¢ Cache Evict&#xa;â€¢ Projections" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="440" y="1160" width="140" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="notification-consumer" value="ðŸŸ¤ NOTIFICATION&#xa;SERVICE&#xa;&#xa;â€¢ WebSocket&#xa;â€¢ Email&#xa;â€¢ SMS/Push" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0e6d4;strokeColor=#d79b00;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="620" y="1160" width="140" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="analytics-consumer" value="ðŸŸ  ANALYTICS&#xa;SERVICE&#xa;&#xa;â€¢ ML Models&#xa;â€¢ Reports&#xa;â€¢ Metrics" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="800" y="1160" width="140" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="backup-consumer" value="âšª BACKUP&#xa;SERVICE&#xa;&#xa;â€¢ S3 Export&#xa;â€¢ Archive&#xa;â€¢ Cold Storage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="980" y="1160" width="140" height="100" as="geometry"/>
        </mxCell>
        
        <!-- Arrows: SQS â†’ Consumers (Long Polling) -->
        <mxCell id="arrow-sqs1-consumer" value="Long Poll&#xa;(20s)" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="sqs-eventstore" target="eventstore-consumer">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="arrow-sqs2-consumer" value="Long Poll&#xa;(20s)" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="sqs-query" target="query-consumer">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="arrow-sqs3-consumer" value="Long Poll&#xa;(20s)" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="sqs-notification" target="notification-consumer">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="arrow-sqs4-consumer" value="Long Poll&#xa;(20s)" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="sqs-analytics" target="analytics-consumer">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="arrow-sqs5-consumer" value="Long Poll&#xa;(20s)" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;dashed=1;dashPattern=8 8;" edge="1" parent="1" source="sqs-backup" target="backup-consumer">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- DATABASES (Consumer Layer) -->
        <mxCell id="eventstore-db" value="ðŸŸ¢ DynamoDB&#xa;&#xa;events&#xa;(append-only)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="270" y="1300" width="120" height="80" as="geometry"/>
        </mxCell>
        
        <mxCell id="query-db" value="ðŸŸ¢ DynamoDB&#xa;&#xa;views&#xa;(read model)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="450" y="1300" width="120" height="80" as="geometry"/>
        </mxCell>
        
        <mxCell id="notification-db" value="ðŸŸ¢ DynamoDB&#xa;&#xa;notifications&#xa;(TTL 90d)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#f0e6d4;strokeColor=#d79b00;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="630" y="1300" width="120" height="80" as="geometry"/>
        </mxCell>
        
        <mxCell id="analytics-db" value="ðŸŸ¢ DynamoDB&#xa;&#xa;metrics&#xa;(time-series)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="810" y="1300" width="120" height="80" as="geometry"/>
        </mxCell>
        
        <mxCell id="backup-s3" value="ðŸŸ¢ Amazon S3&#xa;Glacier&#xa;&#xa;archive&#xa;(cold storage)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="990" y="1300" width="120" height="80" as="geometry"/>
        </mxCell>
        
        <!-- Arrows: Consumers â†’ Databases -->
        <mxCell id="arrow-consumer1-db" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;" edge="1" parent="1" source="eventstore-consumer" target="eventstore-db">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="arrow-consumer2-db" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;" edge="1" parent="1" source="query-consumer" target="query-db">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="arrow-consumer3-db" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;" edge="1" parent="1" source="notification-consumer" target="notification-db">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="arrow-consumer4-db" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;" edge="1" parent="1" source="analytics-consumer" target="analytics-db">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="arrow-consumer5-db" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#000000;" edge="1" parent="1" source="backup-consumer" target="backup-s3">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <!-- NOTES -->
        <mxCell id="note-eventual" value="âš ï¸ EVENTUAL CONSISTENCY&#xa;&#xa;Query Service pode ter lag de 5-20s&#xa;em relaÃ§Ã£o ao Inventory Service" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="1220" y="440" width="220" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="note-outbox" value="ðŸ“¦ TRANSACTIONAL OUTBOX&#xa;&#xa;Inventory Service usa Outbox Pattern&#xa;para garantir entrega de eventos" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="1220" y="570" width="220" height="100" as="geometry"/>
        </mxCell>
        
        <mxCell id="note-cap" value="ðŸŽ¯ CAP THEOREM: CP&#xa;&#xa;Inventory = Consistency + Partition Tolerance&#xa;Query = Availability + Partition Tolerance" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="1220" y="700" width="220" height="100" as="geometry"/>
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>